return {
  {
    "williamboman/mason.nvim",
    config = true,
  },
  {
    "williamboman/mason-lspconfig.nvim",
    dependencies = { "neovim/nvim-lspconfig" },
    config = function()
      require("mason-lspconfig").setup({
        ensure_installed = { "clangd" },
      })

      local lspconfig = require("lspconfig")
      local util = require("lspconfig.util")

      require("mason-lspconfig").setup_handlers({
        -- 既定: そのまま
        function(server)
          lspconfig[server].setup({})
        end,

        -- clangd だけ上書き
        ["clangd"] = function()
          lspconfig.clangd.setup({
            cmd = {
              "clangd",
              "--background-index",
              "--clang-tidy",
              "--query-driver=/usr/bin/clang++", -- ← macOS 安定化
              -- "--compile-commands-dir=build",   -- 直下に symlink 置くなら不要
            },
            root_dir = function(fname)
              return util.root_pattern("compile_commands.json", ".clangd", ".git")(fname)
                  or vim.fs.dirname(fname)
            end,
          })
        end,
      })
    end,
  },
}
